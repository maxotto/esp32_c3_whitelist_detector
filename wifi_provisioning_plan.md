# План реализации Wi-Fi Provisioning через Web-интерфейс

## Общая задача
Добавить возможность настройки Wi-Fi учетных данных (SSID и пароль) через простой веб-интерфейс, запускаемый в режиме точки доступа (AP). Учетные данные должны сохраняться в энергонезависимой памяти (NVS) для последующих перезагрузок.

## Детальный план (повторение и углубление)

1.  **Создание компонента `wifi_manager`:**
    *   Будет содержать всю логику, связанную с Wi-Fi.
    *   Структура: `components/wifi_manager/CMakeLists.txt`, `Kconfig`, `include/wifi_manager.hpp`, `src/wifi_manager.cpp`.
    *   Зависимости: `esp_wifi`, `esp_http_server`, `nvs_flash`.

2.  **Управление учетными данными Wi-Fi (NVS):**
    *   В `wifi_manager` реализовать функции для сохранения `SSID` и `PASSWORD` в NVS.
    *   Реализовать функции для чтения `SSID` и `PASSWORD` из NVS.
    *   Обработка случаев, когда данные отсутствуют или повреждены.

3.  **Режимы работы Wi-Fi (AP/STA):**
    *   **При загрузке:**
        *   Попытаться загрузить сохраненные учетные данные из NVS.
        *   Если учетные данные есть:
            *   Попытаться подключиться в режиме **STA (Station)** к сохраненной сети.
            *   Если подключение успешно, продолжить работу приложения (пинги, LED).
            *   Если подключение неуспешно (неверный пароль, сеть недоступна), переключиться в режим **AP (Access Point)** и запустить веб-сервер.
        *   Если учетных данных нет:
            *   Сразу перейти в режим **AP (Access Point)** и запустить веб-сервер.
    *   **Режим AP:**
        *   Настроить ESP32 как точку доступа с известным SSID (например, "ESP32_Config") и без пароля или с фиксированным паролем.
        *   Запустить HTTP-сервер.

4.  **Веб-сервер и интерфейс:**
    *   Использовать `esp_http_server`.
    *   **Эндпоинт `/`:** Отдавать простую HTML-страницу с формой для ввода SSID и пароля.
    *   **Эндпоинт `/save` (POST):**
        *   Принимать POST-запрос с новыми SSID и паролем.
        *   Сохранять их в NVS.
        *   Возвращать пользователю страницу подтверждения или перенаправлять.
        *   Перезагружать ESP32 для попытки подключения к новой сети.

5.  **HTML-страница:**
    *   Простой HTML с полями `<input type="text" name="ssid">` и `<input type="password" name="password">`.
    *   Кнопка `<button type="submit">Сохранить</button>`.
    *   Можно добавить базовый CSS для лучшего вида. HTML будет встроен в прошивку (например, как строка в `wifi_manager.cpp`).

6.  **Интеграция с `main.cpp`:**
    *   `app_main` будет вызывать `wifi_manager_init()`.
    *   `wifi_manager_init()` будет управлять переключением режимов и запускать веб-сервер/подключение.
    *   Основная логика `app_main` (пинги) будет запускаться только после успешного подключения.

7.  **Удаление жестко закодированных SSID/PASSWORD** из `main.cpp`.

## Важные моменты / Детали, которые нужно учесть:

*   **ESP-IDF API:** Активно использовать `esp_wifi.h`, `nvs_flash.h`, `esp_http_server.h`.
*   **Обработка ошибок:** Везде, где возможно, использовать `ESP_ERROR_CHECK`.
*   **Ивенты Wi-Fi:** Использовать `esp_event` для отслеживания событий подключения/отключения.
*   **Безопасность:** Для демонстрации можно не заморачиваться с HTTPS, но для реальных устройств это важно.
*   **User Experience:** Веб-интерфейс должен быть максимально простым и понятным.

---
Дата создания: понедельник, 1 декабря 2025 г.
